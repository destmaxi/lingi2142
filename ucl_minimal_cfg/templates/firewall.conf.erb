#!/bin/bash

>>>>>>> 1467283... Remove bird6.conf files
# Begin by flushing any default rules to create them from scratch:
#ip6tables -F INPUT
#ip6tables -F OUTPUT
#ip6tables -F FORWARD
#ip6tables -F

# We use a whitlisting policy so we only allow packets that match precise rules and we drop
# anything else, in INPUT/FORWARD/OUTPUT (see our report for more details about whitelisting)
#ip6tables -P OUTPUT DROP
#ip6tables -P INPUT DROP
#ip6tables -P FORWARD DROP

<% if @type == "border" %>
# This router is a 'border router': there is a BGP session running on the interface $interface.
# We block hop limit exceeded towards outside network (rule against topology discovery with traceroute)
#ip6tables -A OUTPUT  -o <%= @interface %> -p icmpv6 --icmpv6-type time-exceeded -j DROP
#ip6tables -A FORWARD -o <%= @interface %> -p icmpv6 --icmpv6-type time-exceeded -j DROP
<%- end -%>

# Allow packets coming from related and established connections
#ip6tables -A OUTPUT  -m state --state ESTABLISHED,RELATED -j ACCEPT
#ip6tables -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
#ip6tables -A INPUT   -m state --state ESTABLISHED,RELATED -j ACCEPT

<% if @type == "border" %>
# Border router: block incomming packets that have a source ip from our network (spoofed source ip).
#ip6tables -A FORWARD -i <%= @interface %> -s <%= @prefix_a %>::/50 -j DROP
#ip6tables -A FORWARD -i <%= @interface %> -s <%= @prefix_b %>::/50 -j DROP
#ip6tables -A INPUT   -i <%= @interface %> -s <%= @prefix_a %>::/50 -j DROP
#ip6tables -A INPUT   -i <%= @interface %> -s <%= @prefix_b %>::/50 -j DROP

# Allow bgp on this border router on the interface where bgp should be enabled
#ip6tables -A OUTPUT -o <%= @interface %> -p tcp -j ACCEPT --dport 179
#ip6tables -A INPUT  -i <%= @interface %> -p tcp -j ACCEPT --dport 179

# Block ospf (in both direction) on interface $interface as we should not receive such
# packet from internet and it permits to avoid by error to send or ospf packet to the internet.
#ip6tables -A INPUT   -i <%= @interface %> -p 89 -j DROP
#ip6tables -A FORWARD -i <%= @interface %> -p 89 -j DROP
#ip6tables -A FORWARD -o <%= @interface %> -p 89 -j DROP
#ip6tables -A OUTPUT  -o <%= @interface %> -p 89 -j DROP

